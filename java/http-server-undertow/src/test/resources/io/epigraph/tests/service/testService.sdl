namespace io.epigraph.server.http

import io.epigraph.tests.Person
import io.epigraph.tests.PersonId
import io.epigraph.tests.User

resource users: map[PersonId,Person] {

  READ {
    outputProjection [](
      :(
        id,
        +record(
          +id,
          +firstName,
          +lastName,
          +bestFriend:(
            +id,
            record( +id, +firstName, +lastName, +bestFriend:id, +worstEnemy )
          )~io.epigraph.tests.User:(
            +record(
              +worstEnemy( +id, +firstName, +lastName, +profile )
              +profile
            )
          )
          +worstEnemy( +id, +firstName, +lastName )
          +friends *(
            :(
              +id,
              record( +id, +firstName, +lastName )
            )
          )
        )
      )~User:(
        +id,
        record( +profile, +worstEnemy( profile ) )
      )
    )
  }

}

resource user: Person {

  READ {
    outputProjection :(
      +id,
      record(
        +id,
        +firstName,
        +lastName,
        +bestFriend:(
          +id,
          record( +id, +firstName, +lastName, +bestFriend:id, +worstEnemy )
        )~io.epigraph.tests.User:(
          +record(
            +worstEnemy( +id, +firstName, +lastName, +profile )
            +profile
          )
        )
        +worstEnemy( +id, +firstName, +lastName )
        +friends *(
          :(
            +id,
            record( +id, +firstName, +lastName )
          )
        )
      )
    )~User:(
      +id,
      record( +profile, +worstEnemy( profile ) )
    )
  }

}
